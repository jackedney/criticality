{
  "version": 1,
  "project": "Code Review Fixes",
  "overview": "Address all code review issues identified in codereview.md, including Markdown formatting, broken links, type compatibility, error handling, security warnings, and cross-platform support.",
  "goals": [
    "Fix Markdown formatting issues (blank lines before code blocks, link syntax)",
    "Resolve broken links and misleading headings in documentation",
    "Fix type compatibility issues between dependencies",
    "Add proper error handling and timeout mechanisms",
    "Add security and privacy warnings for sensitive data handling",
    "Implement cross-platform compatibility (Windows/Unix)",
    "Fix dead code and state synchronization issues",
    "Update examples to match data model definitions"
  ],
  "nonGoals": [
    "No refactoring beyond the specified fixes",
    "No new features or functionality additions"
  ],
  "successMetrics": [
    "All code review items from codereview.md are addressed",
    "No broken links remain in documentation",
    "All TypeScript type compatibility issues resolved",
    "Error handling added to all identified locations"
  ],
  "openQuestions": [],
  "stack": {
    "framework": "TypeScript/Node.js",
    "hosting": "N/A",
    "database": "N/A",
    "auth": "N/A"
  },
  "routes": [],
  "uiNotes": [],
  "dataModel": [],
  "importFormat": {
    "description": "Not applicable",
    "example": {}
  },
  "rules": [
    "Preserve existing functionality while making fixes",
    "Follow existing code conventions in each file",
    "Ensure fixes match the exact specifications in codereview.md"
  ],
  "qualityGates": [
    "npm run typecheck",
    "npm run lint",
    "npm run format:check"
  ],
  "stories": [
    {
      "id": "US-001",
      "title": "Fix Markdown formatting in commit_examples.md",
      "status": "done",
      "dependsOn": [],
      "description": "As a maintainer, I want to fix Markdown formatting issues so documentation renders correctly.",
      "acceptanceCriteria": [
        "Around line 255-292: Add blank line before fenced code blocks after headings 'Single Issue', 'Multiple Issues + Co-author', 'With ! Notation', and 'Config Breaking Change'",
        "Example: heading followed by blank line then code block",
        "Negative case: no blank line before code block should not exist after fix"
      ],
      "startedAt": "2026-01-30T18:54:46.741178+00:00",
      "completedAt": "2026-01-30T18:57:43.683430+00:00",
      "updatedAt": "2026-01-30T18:57:43.683253+00:00"
    },
    {
      "id": "US-002",
      "title": "Fix misleading heading in commit SKILL.md",
      "status": "done",
      "dependsOn": [],
      "description": "As a documentation reader, I want accurate headings so I understand the content.",
      "acceptanceCriteria": [
        "Around line 140-166: Rename 'Merge Commits (PR Closure)' to 'Pull Request Description Format' or 'Creating Pull Requests'",
        "Example: heading reflects PR creation content not merge commits",
        "Negative case: heading no longer misleading"
      ],
      "startedAt": "2026-01-30T18:57:45.777551+00:00",
      "completedAt": "2026-01-30T19:00:29.001147+00:00",
      "updatedAt": "2026-01-30T19:00:29.000976+00:00"
    },
    {
      "id": "US-003",
      "title": "Fix broken links in commit SKILL.md",
      "status": "done",
      "dependsOn": [],
      "description": "As a documentation user, I want working links so I can access referenced resources.",
      "acceptanceCriteria": [
        "Line 126: Fix broken links to 'references/commit_examples.md'",
        "Either add the missing file or remove/update all references",
        "Example: all links resolve to valid resources",
        "Negative case: no broken references remain"
      ],
      "startedAt": "2026-01-30T19:00:31.085561+00:00",
      "completedAt": "2026-01-30T19:02:48.846900+00:00",
      "updatedAt": "2026-01-30T19:02:48.846734+00:00"
    },
    {
      "id": "US-004",
      "title": "Fix @types/express compatibility in dev-browser package.json",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want compatible type definitions so TypeScript compilation succeeds.",
      "acceptanceCriteria": [
        "Around line 18-23: Update '@types/express' from ^5.0.0 to ^4.17.0",
        "Example: types match Express 4.21.0",
        "Negative case: no type errors from Express types"
      ],
      "startedAt": "2026-01-30T19:02:50.936404+00:00",
      "completedAt": "2026-01-30T19:05:29.260343+00:00",
      "updatedAt": "2026-01-30T19:05:29.260111+00:00"
    },
    {
      "id": "US-005",
      "title": "Add privacy guidance for API response capture in scraping.md",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want clear privacy guidance so I handle sensitive data correctly.",
      "acceptanceCriteria": [
        "Around line 59-68: Add privacy notice for tmp/api-response.json capture",
        "Include: validation/redaction of sensitive fields, secure temporary storage, immediate deletion, optional masking/encryption",
        "Example: docs instruct to remove PII before committing",
        "Negative case: no guidance for sensitive data handling"
      ],
      "startedAt": "2026-01-30T19:05:31.346524+00:00",
      "completedAt": "2026-01-30T19:07:45.371879+00:00",
      "updatedAt": "2026-01-30T19:07:45.371531+00:00"
    },
    {
      "id": "US-006",
      "title": "Add error handling guidance in scraping.md",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want error handling examples so production code is robust.",
      "acceptanceCriteria": [
        "Around line 80-138: Add try/catch around page.evaluate fetch, JSON parsing, fs.readFileSync, fs.writeFileSync",
        "Ensure client.disconnect() in finally block, log or rethrow errors",
        "Alternative: comment about handling timeouts, malformed JSON, I/O errors, closed pages",
        "Example: try/catch wrapper around network operations",
        "Negative case: bare operations without error handling"
      ],
      "startedAt": "2026-01-30T19:07:47.460249+00:00",
      "completedAt": "2026-01-30T19:10:49.087533+00:00",
      "updatedAt": "2026-01-30T19:10:49.087378+00:00"
    },
    {
      "id": "US-007",
      "title": "Add legal/ethical guidance to scraping.md Tips section",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want legal guidance so I scrape ethically and compliantly.",
      "acceptanceCriteria": [
        "Around line 150-155: Add bullet under Tips section",
        "Include: review Terms of Service, check robots.txt, honor rate limits, comply with data usage/privacy regulations",
        "Example: concise actionable reminder",
        "Negative case: no legal guidance"
      ],
      "startedAt": "2026-01-30T19:10:51.183563+00:00",
      "completedAt": "2026-01-30T19:12:54.580125+00:00",
      "updatedAt": "2026-01-30T19:12:54.579954+00:00"
    },
    {
      "id": "US-008",
      "title": "Add timeout to fetch in scraping.md",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want timeouts so pagination loops don't hang indefinitely.",
      "acceptanceCriteria": [
        "Around line 101-107: Use AbortController with setTimeout in page.evaluate fetch",
        "Configure timeout (e.g., 10s), clear on success, handle aborted/timeout errors",
        "Example: fetch aborted after timeout",
        "Negative case: fetch can hang indefinitely"
      ],
      "startedAt": "2026-01-30T19:12:56.675116+00:00",
      "completedAt": "2026-01-30T19:16:32.403525+00:00",
      "updatedAt": "2026-01-30T19:16:32.403149+00:00"
    },
    {
      "id": "US-009",
      "title": "Add security warning for sensitive headers in scraping.md",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want security warnings so I don't commit sensitive data.",
      "acceptanceCriteria": [
        "Around line 26-53: Add security warning for tmp/request-details.json with Authorization/Cookie headers",
        "Include: never commit tmp/, delete after use, review/redact headers, suggest programmatic header building or non-sensitive logging",
        "Example: clear warning next to capture logic",
        "Negative case: no warning about sensitive data"
      ],
      "startedAt": "2026-01-30T19:16:34.489347+00:00",
      "completedAt": "2026-01-30T19:19:54.994897+00:00",
      "updatedAt": "2026-01-30T19:19:54.994451+00:00"
    },
    {
      "id": "US-010",
      "title": "Validate PORT environment variable in start-relay.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want PORT validation so the service fails fast on invalid input.",
      "acceptanceCriteria": [
        "Around line 9-10: Validate parseInt(process.env.PORT || '9222', 10) with isFinite, isNaN, >0 checks",
        "Throw clear error or fallback to safe default",
        "Example: 'Invalid PORT value: abc' error thrown",
        "Negative case: PORT never becomes NaN"
      ],
      "startedAt": "2026-01-30T19:19:57.100041+00:00",
      "completedAt": "2026-01-30T19:27:28.242357+00:00",
      "updatedAt": "2026-01-30T19:27:28.241915+00:00"
    },
    {
      "id": "US-011",
      "title": "Fix Playwright install error handling in start-server.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want Playwright install failures to stop execution so servers don't start without browsers.",
      "acceptanceCriteria": [
        "Around line 70-73: Rethrow error or process.exit(1) after 'Failed to install Playwright browsers:' log",
        "Example: script terminates with non-zero exit code",
        "Negative case: server doesn't proceed without browsers"
      ],
      "startedAt": "2026-01-30T19:27:30.342826+00:00",
      "completedAt": "2026-01-30T19:31:12.819890+00:00",
      "updatedAt": "2026-01-30T19:31:12.819659+00:00"
    },
    {
      "id": "US-012",
      "title": "Add Windows support to isChromiumInstalled in start-server.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want cross-platform support so the script works on Windows.",
      "acceptanceCriteria": [
        "Around line 38-53: Detect platform, use LOCALAPPDATA/USERPROFILE + 'ms-playwright' on win32, keep Unix path otherwise",
        "Example: uses correct path on Windows",
        "Negative case: doesn't break on Unix"
      ],
      "startedAt": "2026-01-30T19:31:14.910065+00:00",
      "completedAt": "2026-01-30T19:37:48.749666+00:00",
      "updatedAt": "2026-01-30T19:37:48.749508+00:00"
    },
    {
      "id": "US-013",
      "title": "Add Windows support to crash-recovery cleanup in start-server.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want cross-platform process cleanup so servers recover on all OS.",
      "acceptanceCriteria": [
        "Around line 89-99: Branch on os.platform() for lsof/kill (non-win32) vs taskkill/netstat (win32)",
        "Example: uses taskkill on Windows, lsof/kill on Unix",
        "Negative case: works on both platforms"
      ],
      "startedAt": "2026-01-30T19:37:50.828646+00:00",
      "completedAt": "2026-01-30T19:42:34.997200+00:00",
      "updatedAt": "2026-01-30T19:42:34.997014+00:00"
    },
    {
      "id": "US-014",
      "title": "Guard cd command in server.sh",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want to fail fast on directory change errors so scripts don't run in wrong location.",
      "acceptanceCriteria": [
        "Around line 4-7: Check cd exit status, log error mentioning SCRIPT_DIR, exit non-zero if fail",
        "Example: 'Failed to cd to /path' error",
        "Negative case: script doesn't run on cd failure"
      ],
      "startedAt": "2026-01-30T19:42:37.088347+00:00",
      "completedAt": "2026-01-30T19:45:18.077397+00:00",
      "updatedAt": "2026-01-30T19:45:18.077218+00:00"
    },
    {
      "id": "US-015",
      "title": "Fix URL formatting in dev-browser SKILL.md",
      "status": "done",
      "dependsOn": [],
      "description": "As a documentation reader, I want properly formatted Markdown links.",
      "acceptanceCriteria": [
        "Line 51: Replace bare URL with Markdown link syntax [text](url)",
        "Example: 'Download link: [dev-browser releases](https://github.com/SawyerHood/dev-browser/releases)'",
        "Negative case: no bare URLs"
      ],
      "startedAt": "2026-01-30T19:45:20.173154+00:00",
      "completedAt": "2026-01-30T19:47:59.884487+00:00",
      "updatedAt": "2026-01-30T19:47:59.884237+00:00"
    },
    {
      "id": "US-016",
      "title": "Replace eval with script injection in client.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want safer script injection to avoid eval usage.",
      "acceptanceCriteria": [
        "Around line 408-420: Use page.addScriptTag({ content: snapshotScript }) instead of eval inside page.evaluate",
        "Check if function exists via page.evaluate before injecting, call __devBrowser_getAISnapshot after",
        "Example: script injected safely",
        "Negative case: no eval usage"
      ],
      "startedAt": "2026-01-30T19:48:01.977802+00:00",
      "completedAt": "2026-01-30T19:54:49.182579+00:00",
      "updatedAt": "2026-01-30T19:54:49.182398+00:00"
    },
    {
      "id": "US-017",
      "title": "Fix forEach callbacks to block style in index.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want explicit arrow functions to avoid implicit returns.",
      "acceptanceCriteria": [
        "Around line 266-276: Change signals.forEach callbacks to block-style with explicit statements",
        "Example: signals.forEach((sig) => { process.on(sig, signalHandler); })",
        "Negative case: no implicit returns"
      ],
      "startedAt": "2026-01-30T19:54:51.278661+00:00",
      "completedAt": "2026-01-30T19:58:54.762213+00:00",
      "updatedAt": "2026-01-30T19:58:54.761998+00:00"
    },
    {
      "id": "US-018",
      "title": "Fix page creation timeout leak in index.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want proper cleanup so timeouts don't leak pages.",
      "acceptanceCriteria": [
        "Around line 153-167: Use Promise.race with timeout, attach continuation to close page if timeout wins",
        "Ensure getTargetId and registry.set only after successful Page",
        "Example: orphaned pages closed on timeout",
        "Negative case: no page leaks"
      ],
      "startedAt": "2026-01-30T19:58:56.856969+00:00",
      "completedAt": "2026-01-30T20:13:20.834785+00:00",
      "updatedAt": "2026-01-30T20:13:20.834581+00:00"
    },
    {
      "id": "US-019",
      "title": "Clean dedup state on target detach in relay.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want target dedup state cleaned so targets can re-attach.",
      "acceptanceCriteria": [
        "Around line 630-640: In Target.detachedFromTarget handler, iterate all clients and delete sessionId from knownTargets",
        "Example: targetId removed from every client's state",
        "Negative case: stale state doesn't block re-attach"
      ],
      "startedAt": "2026-01-30T20:13:22.915813+00:00",
      "completedAt": "2026-01-30T20:17:45.112419+00:00",
      "updatedAt": "2026-01-30T20:17:45.112218+00:00"
    },
    {
      "id": "US-020",
      "title": "Add error handling and polling to POST /pages in relay.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want robust request handling and bounded polling.",
      "acceptanceCriteria": [
        "Around line 351-422: Wrap c.req.json() in try/catch returning 400 on invalid JSON",
        "Replace fixed sleep with bounded polling (50-200ms, 3-5s timeout) checking connectedTargets for matching targetId",
        "Remove namedPages entry and return 500 on timeout",
        "Example: returns 400 on bad JSON, polls for target creation",
        "Negative case: doesn't hang indefinitely"
      ],
      "startedAt": "2026-01-30T20:17:47.189716+00:00",
      "completedAt": "2026-01-30T20:20:19.728053+00:00",
      "updatedAt": "2026-01-30T20:20:19.727913+00:00"
    },
    {
      "id": "US-021",
      "title": "Await server close in relay.ts stop()",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want to await server shutdown so stop() fully resolves.",
      "acceptanceCriteria": [
        "Around line 707-729: Await server.close() in stop() before returning",
        "Keep existing client socket and extension WS closing before await, clear playwrightClients after",
        "Example: stop() resolves only after server closed",
        "Negative case: stop() returns immediately"
      ],
      "startedAt": "2026-01-30T20:20:21.804494+00:00",
      "completedAt": "2026-01-30T20:22:21.697145+00:00",
      "updatedAt": "2026-01-30T20:22:21.696968+00:00"
    },
    {
      "id": "US-022",
      "title": "Replace eval with script injection in snapshot.test.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want safer script injection in tests.",
      "acceptanceCriteria": [
        "Around line 32-42: Use page.addScriptTag({ content: script }) instead of eval injection",
        "Call getSnapshotScript() to get script, await addScriptTag, then page.evaluate to call __devBrowser_getAISnapshot",
        "Example: test uses safe injection",
        "Negative case: no eval in test"
      ],
      "startedAt": "2026-01-30T20:22:23.779621+00:00",
      "completedAt": "2026-01-30T20:25:33.408962+00:00",
      "updatedAt": "2026-01-30T20:25:33.408798+00:00"
    },
    {
      "id": "US-023",
      "title": "Update TypeScript dependency for Preserve module in tsconfig.json",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want compatible TypeScript version for 'Preserve' module option.",
      "acceptanceCriteria": [
        "Line 6: Update TypeScript dependency in package.json to ^5.4.0 or later",
        "Example: supports 'module': 'Preserve'",
        "Negative case: no compiler errors"
      ],
      "startedAt": "2026-01-30T20:25:35.488273+00:00",
      "completedAt": "2026-01-30T20:28:01.311551+00:00",
      "updatedAt": "2026-01-30T20:28:01.311361+00:00"
    },
    {
      "id": "US-024",
      "title": "Fix example slug capitalization in prd SKILL.md",
      "status": "done",
      "dependsOn": [],
      "description": "As a documentation reader, I want consistently capitalized example slugs.",
      "acceptanceCriteria": [
        "Around line 162-164: Change `prd-workout-tracker.json`, `prd-usage-billing.json` to `prd-Workout-Tracker.json`, `prd-Usage-Billing.json`",
        "Example: capitalised slugs in examples",
        "Negative case: no lowercase slugs"
      ],
      "startedAt": "2026-01-30T20:28:03.396033+00:00",
      "completedAt": "2026-01-30T20:31:22.849425+00:00",
      "updatedAt": "2026-01-30T20:31:22.849073+00:00"
    },
    {
      "id": "US-025",
      "title": "Fix verb form 'setup' to 'set up' in prd SKILL.md",
      "status": "done",
      "dependsOn": [],
      "description": "As a documentation reader, I want correct grammar with proper verb forms.",
      "acceptanceCriteria": [
        "Around line 147-149: Replace 'setup' with 'set up' where used as verb in bullets",
        "Example: 'include initial set up stories', 'first story must be set up'",
        "Negative case: 'setup' only used as noun"
      ],
      "startedAt": "2026-01-30T20:31:24.943352+00:00",
      "completedAt": "2026-01-30T20:36:48.494096+00:00",
      "updatedAt": "2026-01-30T20:36:48.493901+00:00"
    },
    {
      "id": "US-026",
      "title": "Remove dead testDir usage in cli.test.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want no dead code so the codebase is clean.",
      "acceptanceCriteria": [
        "Around line 629-631: Delete testDir assignment in beforeEach, remove or update class-level testDir declaration",
        "Example: testDir not declared or used",
        "Negative case: no unused testDir"
      ],
      "startedAt": "2026-01-30T20:49:57.711903+00:00",
      "completedAt": "2026-01-30T20:54:22.175396+00:00",
      "updatedAt": "2026-01-30T20:54:22.175202+00:00"
    },
    {
      "id": "US-027",
      "title": "Make createReadlineReader async in cli.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want dynamic imports with async/await instead of synchronous require.",
      "acceptanceCriteria": [
        "Around line 1287-1309: Change createReadlineReader to async returning Promise<InputReader>, replace require with await import('node:readline'), update callers to await",
        "Example: dynamic import used",
        "Negative case: no synchronous require"
      ],
      "startedAt": "2026-01-30T20:54:24.259311+00:00",
      "completedAt": "2026-01-30T20:57:30.831751+00:00",
      "updatedAt": "2026-01-30T20:57:30.831577+00:00"
    },
    {
      "id": "US-028",
      "title": "Fix transcriptEntryCount synchronization in cli.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want accurate transcript count tracking.",
      "acceptanceCriteria": [
        "Around line 1095-1127: Use appendTranscriptEntryAndUpdateState in handleQuestion and handleApproval, or increment count and save after every append",
        "Example: count stays in sync with actual entries",
        "Negative case: no count drift"
      ],
      "startedAt": "2026-01-30T20:57:32.907934+00:00",
      "completedAt": "2026-01-30T21:02:33.465393+00:00",
      "updatedAt": "2026-01-30T21:02:33.465037+00:00"
    },
    {
      "id": "US-029",
      "title": "Replace delegable question with open-text in engine.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want open-text prompting after Continue decision.",
      "acceptanceCriteria": [
        "Around line 921-941: When response.decision === 'Continue', replace delegable question with open-text question for same phase",
        "Example: currentQuestion.type is open-text variant",
        "Negative case: doesn't re-display delegation options"
      ],
      "startedAt": "2026-01-30T21:02:35.547705+00:00",
      "completedAt": "2026-01-30T21:07:01.291818+00:00",
      "updatedAt": "2026-01-30T21:07:01.291703+00:00"
    },
    {
      "id": "US-030",
      "title": "Validate/sanitize projectId in persistence.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want path validation to prevent directory traversal attacks.",
      "acceptanceCriteria": [
        "Around line 85-93: Validate projectId rejects empty, absolute paths, '../' segments, path separators, or use normalise/slugify to safe token",
        "Example: invalid projectId throws error",
        "Negative case: no path traversal possible"
      ],
      "startedAt": "2026-01-30T21:07:03.369132+00:00",
      "completedAt": "2026-01-30T21:12:15.296117+00:00",
      "updatedAt": "2026-01-30T21:12:15.295973+00:00"
    },
    {
      "id": "US-031",
      "title": "Move timer setup to hooks in types.test.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want consistent timer mocking across tests.",
      "acceptanceCriteria": [
        "Around line 455-464: Move vi.useFakeTimers/vi.setSystemTime to beforeEach, vi.useRealTimers to afterEach",
        "Example: timer setup in hooks",
        "Negative case: no inline timer calls in test"
      ],
      "startedAt": "2026-01-30T21:12:17.375264+00:00",
      "completedAt": "2026-01-30T21:15:47.431323+00:00",
      "updatedAt": "2026-01-30T21:15:47.431161+00:00"
    },
    {
      "id": "US-032",
      "title": "Fix InterviewState example in types.ts",
      "status": "done",
      "dependsOn": [],
      "description": "As a documentation reader, I want examples that match the type definition.",
      "acceptanceCriteria": [
        "Around line 165-187: Remove transcript array from InterviewState example, add transcriptEntryCount: number (e.g., 0)",
        "Example: example matches InterviewState shape",
        "Negative case: no mismatched fields"
      ],
      "startedAt": "2026-01-30T21:15:49.512056+00:00",
      "completedAt": "2026-01-30T21:19:08.686084+00:00",
      "updatedAt": "2026-01-30T21:19:08.685936+00:00"
    }
  ]
}
