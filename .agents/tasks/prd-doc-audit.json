{
  "version": 2,
  "project": "Criticality Protocol - Documentation Audit & Phase 1-4 Verification",
  "overview": "Comprehensive audit ensuring SPECIFICATION.md, ROADMAP.md, DECISIONS.toml, and README.md are internally consistent, cross-consistent, and accurately reflect the implemented state of development phases 1-4 (excluding notification features). Fixes known documentation issues (section numbering, phase naming, model aliases, stale checkboxes) and performs deep code-to-spec verification for all protocol phases, producing markdown discrepancy reports with potential solutions.",
  "goals": [
    "Fix all known documentation inconsistencies across SPECIFICATION.md, ROADMAP.md, DECISIONS.toml, and README.md",
    "Replace all phase number prefixes (Phase I/II/III/IV) with semantic names per decision phase_005",
    "Replace all specific model name references with role aliases per decision model_006",
    "Fix SPECIFICATION.md section numbering end-to-end",
    "Update ROADMAP.md to reflect actual Phase 4.1 and 4.3 completion status",
    "Deep verify every protocol phase implementation (Ignition through Mass Defect) against its spec definition, checking types, signatures, state machine states, transition guards, escalation logic, and circuit breaker config",
    "Deep verify orchestrator state machine, transitions, and persistence against spec section 9",
    "Produce markdown discrepancy reports for all code-to-spec mismatches with potential solutions",
    "Ensure all quality gates pass after all documentation changes"
  ],
  "nonGoals": [
    "Implementing any new features or code changes",
    "Fixing code bugs discovered during audit (only document discrepancies with potential solutions)",
    "Auditing notification-specific features (webhooks, cron, reminders, notification service)",
    "Auditing Phase 5+ (future phases: Rust/Python/Go adapters, production hardening, advanced features)",
    "Modifying test files or adding new tests",
    "Changing any implementation code in src/"
  ],
  "successMetrics": [
    "All section numbers in SPECIFICATION.md are correct and sequential end-to-end",
    "Zero references to 'Phase I', 'Phase II', 'Phase III', 'Phase IV' remain in SPECIFICATION.md",
    "Zero specific model name references remain in SPECIFICATION.md tables/text (only role aliases)",
    "DECISIONS.toml model-related constraint text uses role aliases exclusively while rationale preserves specific model names for context",
    "ROADMAP.md Phase 4.1 checkboxes all marked [x] and accurately reflect implementation",
    "ROADMAP.md status header reads 'Phase 4.1, 4.3 Complete, Phase 4.2 Partial'",
    "README.md is consistent with updated SPECIFICATION.md and ROADMAP.md",
    "One markdown discrepancy report per verified area in .agents/audits/",
    "Master discrepancy index produced at .agents/audits/discrepancy-index.md",
    "All quality gates pass: npm run test, npm run lint, npm run typecheck, npm run build"
  ],
  "openQuestions": [],
  "stack": {
    "framework": "TypeScript (existing codebase)",
    "hosting": "Local CLI (npm package)",
    "database": "File-based state persistence (existing)",
    "auth": "N/A"
  },
  "routes": [],
  "uiNotes": [],
  "dataModel": [
    {
      "entity": "DiscrepancyReport",
      "fields": [
        "phase (string: which phase/area was verified)",
        "category (string: type-mismatch | missing-implementation | spec-deviation | naming-inconsistency | state-machine-mismatch | config-mismatch)",
        "description (string: what the discrepancy is)",
        "specReference (string: SPECIFICATION.md section + line range)",
        "codeReference (string: file path + line range)",
        "severity (string: critical | warning | info)",
        "potentialSolutions (string[]: list of possible resolutions)"
      ]
    }
  ],
  "importFormat": {
    "description": "Not applicable - documentation audit producing markdown reports",
    "example": {}
  },
  "rules": [
    "SPECIFICATION.md is the primary source of truth for protocol design",
    "DECISIONS.toml is the ultimate authority for resolving ambiguities between spec and code",
    "Code-to-spec mismatches produce markdown reports with potential solutions, NOT code fixes",
    "Notification features (Phase 4.2) are excluded except for verifying that webhook integration (which has been attempted and completed) is accurately reflected",
    "Phase number prefixes (Phase I, II, III, IV, III.5) must be replaced with semantic names only (Ignition, Lattice, Composition Audit, Injection, Mesoscopic, Mass Defect)",
    "Specific model names (MiniMax M2, Kimi K2, Claude Opus 4.5, Claude Sonnet 4.5) in SPECIFICATION.md must be replaced with role aliases (architect_model, auditor_model, worker_model, structurer_model, fallback_model)",
    "In DECISIONS.toml, constraint text is rewritten to role aliases but rationale fields preserve specific model names for historical context",
    "Discrepancy reports use consistent format: summary, conformance verdict, list of findings with severity/references/solutions",
    "Each discrepancy report saved to .agents/audits/<area-name>.md"
  ],
  "qualityGates": [
    "npm run test",
    "npm run lint",
    "npm run typecheck",
    "npm run build"
  ],
  "stories": [
    {
      "id": "US-001",
      "title": "Update ROADMAP.md status header and Phase 4 checkboxes",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want ROADMAP.md to accurately reflect the current project state so that anyone reading it understands what has been completed.",
      "acceptanceCriteria": [
        "Change 'Current Status: Phase 3 Complete' header to 'Current Status: Phase 4.1, 4.3 Complete, Phase 4.2 Partial'",
        "Update the status summary paragraph below the header to accurately describe Phase 4 achievements (CLI interface, web dashboard deferred)",
        "Mark Phase 4.1 CLI Interface items as [x]: blocking query display, option selection, clarification input, status display, resume command",
        "For Phase 4.2, mark [x] on 'Implement reminder scheduling' if src/notifications/reminder.ts exists and is tested (verify first)",
        "For Phase 4.2, mark [x] on 'Implement notification trait' if src/notifications/types.ts or equivalent exists with a notification interface/type (verify first)",
        "Leave Phase 4.2 Slack and email items as [ ] since they are deferred",
        "Mark Phase 4.3 items appropriately: all remain [ ] but add '(deferred - optional)' suffix if not already present",
        "Verify all Phase 0, 1, 2, 3 checkboxes are accurate (all should be [x]) by spot-checking at least 3 items per phase against actual code",
        "Example: Phase 4.1 '[ ] Implement status display' becomes '[x] Implement status display' because src/cli/commands/status.ts exists",
        "Negative case: Do not mark Phase 4.3 Web Dashboard items as [x] since they are not implemented"
      ],
      "startedAt": "2026-02-10T23:23:03.600513+00:00",
      "completedAt": "2026-02-10T23:34:51.901815+00:00",
      "updatedAt": "2026-02-10T23:34:51.901362+00:00"
    },
    {
      "id": "US-002",
      "title": "Fix SPECIFICATION.md section numbering end-to-end",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want all section and subsection numbers in SPECIFICATION.md to be correct and sequential so that cross-references work and the document is navigable.",
      "acceptanceCriteria": [
        "Audit every section heading (## and ###) in SPECIFICATION.md for correct numbering",
        "Fix Section 9 'Orchestrator Specification' internal subsections: change '8.1 Responsibilities' to '9.1', '8.2 State Hierarchy' to '9.2', '8.3 State Definitions' to '9.3', '8.4 Transition Definitions' to '9.4', '8.5 Tick Function' to '9.5', '8.6 Persistence and Resume' to '9.6', '8.7 Invariants' to '9.7', '8.8 AST Operations' to '9.8'",
        "Verify sections 1-8 have correct sequential numbering with no gaps or duplicates",
        "Verify all internal cross-references (e.g., 'See Section X.Y') point to correct section numbers after renumbering",
        "Update the Table of Contents (section links at top) if any section numbers changed",
        "Example: '### 8.1 Responsibilities' under '## 9. Orchestrator Specification' becomes '### 9.1 Responsibilities'",
        "Negative case: Do not renumber sections that are already correctly numbered (e.g., Section 4 Phase Definitions subsections)"
      ],
      "startedAt": "2026-02-10T23:34:53.988205+00:00",
      "completedAt": "2026-02-10T23:41:16.800802+00:00",
      "updatedAt": "2026-02-10T23:41:16.800620+00:00"
    },
    {
      "id": "US-003",
      "title": "Replace phase number prefixes with semantic names in SPECIFICATION.md",
      "status": "done",
      "dependsOn": [
        "US-002"
      ],
      "description": "As a developer, I want SPECIFICATION.md to use semantic phase names exclusively (per decision phase_005) so that the documentation is consistent with the project's naming convention.",
      "acceptanceCriteria": [
        "Replace all occurrences of 'Phase I:' or 'Phase I ' with just the semantic name 'Ignition'",
        "Replace all occurrences of 'Phase II:' or 'Phase II ' with 'Lattice'",
        "Replace all occurrences of 'Phase III:' or 'Phase III ' with 'Injection'",
        "Replace all occurrences of 'Phase III.5:' or 'Phase III.5 ' with 'Mesoscopic'",
        "Replace all occurrences of 'Phase IV:' or 'Phase IV ' with 'Mass Defect'",
        "Update section headings under '## 4. Phase Definitions' to use semantic names only (e.g., '### Ignition (Specification Interrogation)' not '### Phase I: Ignition')",
        "Update all ASCII art diagrams that reference phase numbers (e.g., architecture overview diagram in section 3)",
        "Update the Phase Transition Rules table in section 3 to use semantic names",
        "Update the Failure Transitions table in section 3 to use semantic names",
        "Preserve 'Composition Audit' as-is (it was never numbered)",
        "Search for any remaining 'Phase [IVXL]' patterns and replace with semantic names",
        "Example: 'PHASE I: IGNITION' in ASCII diagrams becomes 'IGNITION' or 'Ignition'",
        "Negative case: Do not change references to interview sub-phases (PHASE 1: DISCOVERY, PHASE 2: ARCHITECTURE, etc. within the Ignition Interview Structure) as these are internal interview phases, not protocol phases"
      ],
      "startedAt": "2026-02-10T23:41:18.885286+00:00",
      "completedAt": "2026-02-10T23:45:13.482030+00:00",
      "updatedAt": "2026-02-10T23:45:13.481602+00:00"
    },
    {
      "id": "US-004",
      "title": "Replace specific model names with role aliases in SPECIFICATION.md",
      "status": "done",
      "dependsOn": [
        "US-003"
      ],
      "description": "As a developer, I want SPECIFICATION.md to reference models by role alias only (per decision model_006) so that the spec remains accurate as models evolve.",
      "acceptanceCriteria": [
        "Replace 'MiniMax M2' with 'worker_model' in all tables, text, and code examples throughout SPECIFICATION.md",
        "Replace 'Kimi K2' with 'auditor_model' in all tables, text, and code examples",
        "Replace 'Claude Opus 4.5' with 'architect_model' in all tables, text, and code examples",
        "Replace 'Claude Sonnet 4.5' with 'structurer_model' in all tables, text, and code examples",
        "Update the Model Assignment tables in each phase definition (Ignition, Lattice, Composition Audit, Injection, Mesoscopic, Mass Defect) to use role aliases",
        "Update Section 7 'Model Allocation' tables: 'Initial Model Selection' table, 'Phase-Role Mapping' table, context limits table, provider configuration",
        "Update the Mass Defect Model Assignment table (around line 1260) to use role aliases",
        "Update the Escalation Table in Section 5.4 to use role aliases instead of specific model names",
        "Preserve specific model names ONLY in the Provider Configuration section (7.1) where they are explicitly mapped to role aliases (this is the configuration documentation)",
        "Update code examples (TypeScript interfaces like ProviderConfig, ModelRouting) to use role aliases or clearly label as configuration examples",
        "Example: Mass Defect table row 'Reducer | MiniMax M2 | Fast, good at local transforms' becomes 'Reducer | worker_model | Fast, good at local transforms'",
        "Negative case: Do not remove specific model names from the Provider Configuration mapping section (Section 7.1) since that section's purpose is to document the alias-to-model mapping"
      ],
      "startedAt": "2026-02-10T23:45:15.570935+00:00",
      "completedAt": "2026-02-10T23:52:30.724483+00:00",
      "updatedAt": "2026-02-10T23:52:30.724304+00:00"
    },
    {
      "id": "US-005",
      "title": "Rewrite DECISIONS.toml model constraints to use role aliases",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want DECISIONS.toml constraint text to use role aliases exclusively so that decisions remain valid as models change, while preserving historical context in rationale fields.",
      "acceptanceCriteria": [
        "Rewrite inject_003 constraint from 'Escalation chain: MiniMax M2 -> Sonnet 4.5 -> Opus 4.5 -> Human' to 'Escalation chain: worker_model -> structurer_model -> architect_model -> Human'",
        "Rewrite model_001 constraint from 'Claude Opus 4.5 for high-level architecture and complex reasoning' to 'architect_model assigned to high-level architecture and complex reasoning'",
        "Rewrite model_002 constraint from 'Kimi K2 on Groq for fast logical consistency auditing' to 'auditor_model assigned to fast logical consistency auditing'",
        "Rewrite model_003 constraint from 'MiniMax M2 on Cerebras as primary Injection worker' to 'worker_model assigned as primary Injection worker'",
        "Rewrite model_004 constraint from 'Claude Sonnet 4.5 for structure generation and as first fallback' to 'structurer_model assigned to structure generation and as first fallback'",
        "Preserve all rationale fields unchanged - they retain specific model names as historical context (e.g., 'Opus has the strongest reasoning capabilities')",
        "Preserve all other fields (id, timestamp, category, source, confidence, phase, dependencies) unchanged",
        "Verify the rewritten constraints still parse correctly as valid TOML",
        "Example: model_001 constraint changes but rationale stays 'Opus has the strongest reasoning capabilities. Used for Ignition...'",
        "Negative case: Do not modify model_005 or model_006 since they already define the alias convention itself"
      ],
      "startedAt": "2026-02-10T23:52:32.796614+00:00",
      "completedAt": "2026-02-10T23:57:45.309366+00:00",
      "updatedAt": "2026-02-10T23:57:45.308906+00:00"
    },
    {
      "id": "US-006",
      "title": "Audit and update README.md for consistency",
      "status": "done",
      "dependsOn": [
        "US-001",
        "US-004"
      ],
      "description": "As a developer, I want README.md to be consistent with the updated SPECIFICATION.md and ROADMAP.md so that the project's public-facing documentation is accurate.",
      "acceptanceCriteria": [
        "Verify README.md architecture diagram matches the SPECIFICATION.md section 3 diagram (same phases, same flow)",
        "Update any phase number references (Phase I, II, etc.) to semantic names if present",
        "Update any specific model name references to role aliases if present",
        "Verify the project status/description matches ROADMAP.md's updated status header",
        "Verify any feature lists or capability descriptions match what is actually implemented",
        "Check all links in README.md point to valid targets (section anchors, files, etc.)",
        "Verify version number consistency between README.md, package.json, and SPECIFICATION.md",
        "Example: If README says 'Phase 3 Complete' in status section, update to match ROADMAP's new status",
        "Negative case: Do not add new content to README.md that doesn't already exist - only fix inconsistencies"
      ],
      "startedAt": "2026-02-10T23:57:47.393257+00:00",
      "completedAt": "2026-02-11T00:00:54.211620+00:00",
      "updatedAt": "2026-02-11T00:00:54.211149+00:00"
    },
    {
      "id": "US-007",
      "title": "Deep verify Core Infrastructure (Dev Phase 1) implementation vs spec",
      "status": "done",
      "dependsOn": [
        "US-004",
        "US-005"
      ],
      "description": "As a developer, I want a verified report confirming that all Dev Phase 1 (Core Infrastructure) components match their SPECIFICATION.md and ROADMAP.md descriptions so that I know the foundation is correctly implemented.",
      "acceptanceCriteria": [
        "Create .agents/audits/ directory if it doesn't exist",
        "Produce .agents/audits/verify-core-infrastructure.md report",
        "Verify config system (src/config/): TOML parser handles spec.toml schema from SPECIFICATION.md section 4, environment overrides work, validation covers all required fields",
        "Verify Decision Ledger (src/ledger/): implements all LedgerOp types from SPECIFICATION.md section 5.1 (append, supersede, invalidate, cascade, reinstate), confidence levels match spec (canonical, delegated, inferred, provisional, suspended, blocking), DecisionStatus types match (active, superseded, invalidated)",
        "Verify Protocol State Machine (src/protocol/): ProtocolState type matches spec section 9.3, BlockReason variants match spec (canonical_conflict, unresolved_contradiction, circuit_breaker, security_review, user_requested), blocking behavior matches spec section 5.5",
        "Verify Model Router (src/router/): implements routing for Claude Code and OpenCode paths per routing_003 decision, retry logic exists, context budgeting per SPECIFICATION.md section 7.2",
        "Verify MCP Servers (src/servers/): artifact-server tools match spec section 8.1 (read_spec_section, append_decision, get_type_witness, validate_schema), toolchain-server tools match spec section 8.1 (verify_structure, run_function_test, run_property_test, check_complexity)",
        "Verify Agent Skills (src/agents/): skill registry matches spec section 8.2 phase-skill mapping",
        "For each discrepancy found: document with spec reference, code reference, severity, and potential solutions",
        "Report overall conformance verdict: conformant / partially conformant / non-conformant",
        "Example: If src/ledger/ exports 'supersede' operation matching spec's LedgerOp type, mark as conformant",
        "Negative case: If a spec-defined tool like 'validate_schema' is missing from artifact-server, document as critical discrepancy with solution options"
      ],
      "startedAt": "2026-02-11T00:00:56.288469+00:00",
      "completedAt": "2026-02-11T00:12:20.495328+00:00",
      "updatedAt": "2026-02-11T00:12:20.494934+00:00"
    },
    {
      "id": "US-008",
      "title": "Deep verify TypeScript Adapter (Dev Phase 2) implementation vs spec",
      "status": "done",
      "dependsOn": [
        "US-004",
        "US-005"
      ],
      "description": "As a developer, I want a verified report confirming that all Dev Phase 2 (TypeScript Adapter) components match their SPECIFICATION.md descriptions so that I know the language adapter is correctly implemented.",
      "acceptanceCriteria": [
        "Produce .agents/audits/verify-typescript-adapter.md report",
        "Verify AST Operations (src/adapters/typescript/): function body injection works via ts-morph per spec section 9.8, todo!() detection (throw new Error('TODO')) matches spec section 4 Lattice definition, signature extraction and type extraction are implemented",
        "Verify Compiler Integration: tsc wrapper produces structured error format per spec, test runner wrapper (vitest) parses results into structured format",
        "Verify Type Witness Generator: generates branded type witnesses matching SPECIFICATION.md section 5.2 TypeScript example (declare const __Brand: unique symbol pattern), validation factory functions generated, runtime assertions generated, fast-check Arbitrary instances generated",
        "Verify Micro-Contract Parser: parses all contract clauses from spec section 5.3 grammar (REQUIRES, ENSURES, INVARIANT, COMPLEXITY, PURITY, CLAIM_REF), validates contract syntax, generates contract objects for prompts",
        "Verify Property Test Generator: claim parser handles all 6 claim types from spec section 6 (Invariant, Behavioral, Negative, Temporal, Concurrent, Performance), generates appropriate test types per Framework Mapping table in spec section 6",
        "For each discrepancy found: document with spec reference, code reference, severity, and potential solutions",
        "Report overall conformance verdict",
        "Example: If witness generator produces 'declare const __SortedVecBrand: unique symbol' matching spec section 5.2, mark as conformant",
        "Negative case: If CLAIM_REF parsing is missing from micro-contract parser, document as warning discrepancy since it affects Mesoscopic re-injection scoping"
      ],
      "startedAt": "2026-02-11T00:24:41.624964+00:00",
      "completedAt": "2026-02-11T00:29:45.142143+00:00",
      "updatedAt": "2026-02-11T00:29:45.141971+00:00"
    },
    {
      "id": "US-009",
      "title": "Deep verify Ignition phase implementation vs spec",
      "status": "done",
      "dependsOn": [
        "US-004",
        "US-005"
      ],
      "description": "As a developer, I want a verified report confirming the Ignition phase implementation matches SPECIFICATION.md section 4 (Ignition) in types, signatures, interview structure, delegation, auditor integration, and context shedding.",
      "acceptanceCriteria": [
        "Produce .agents/audits/verify-ignition.md report",
        "Verify interview structure matches spec: 6 phases (Discovery, Architecture, Constraints, Design Preferences, Synthesis, Approval) in correct order",
        "Verify delegation points: user can delegate at Constraints and Design Preferences phases per spec",
        "Verify feature classification: Core/Foundational/Bolt-on categories exist and are used during interview per spec section 4",
        "Verify interview state persistence: state.json, transcript.jsonl, proposals/ structure matches spec's persistence layout",
        "Verify resume behavior: loads persisted state, generates summary from extracted_requirements, presents summary, resumes from exact position per spec",
        "Verify proposal and approval flow: Approve/Revise/Reject/Conditional paths match spec's flow diagram",
        "Verify adversarial auditor integration: auditor challenges proposal during synthesis per spec",
        "Verify spec artifact schema: generated spec.toml matches schema from spec section 4 (meta, system, boundaries, data_models, interfaces, constraints, claims sections)",
        "Verify IgnitionSubState types match spec section 9.3: interviewing/synthesizing/awaitingApproval with correct data interfaces (InterviewingData, SynthesizingData, AwaitingApprovalData)",
        "Verify model assignments: architect_model for primary, auditor_model for adversarial auditor",
        "Verify context shedding: upon spec finalization, conversation history is discarded, only spec.toml and ledger persist",
        "Example: If InterviewingData has 'interviewPhase' with values matching spec ('discovery'|'architecture'|'constraints'|'designPrefs'), mark conformant",
        "Negative case: If conditional approval doesn't record provisional ledger entries per decision phase_004, document as critical discrepancy"
      ],
      "startedAt": "2026-02-11T00:29:47.226629+00:00",
      "completedAt": "2026-02-11T00:41:41.638960+00:00",
      "updatedAt": "2026-02-11T00:41:41.638544+00:00"
    },
    {
      "id": "US-010",
      "title": "Deep verify Lattice phase implementation vs spec",
      "status": "in_progress",
      "dependsOn": [
        "US-004",
        "US-005"
      ],
      "description": "As a developer, I want a verified report confirming the Lattice phase implementation matches SPECIFICATION.md section 4 (Lattice) in types, generation mechanism, compilation verification, and witness integration.",
      "acceptanceCriteria": [
        "Produce .agents/audits/verify-lattice.md report",
        "Verify Lattice definition completeness: module hierarchy, structs/enums/traits/interfaces, function signatures with todo!() bodies, type witnesses, micro-contracts as documentation",
        "Verify Lattice exclusions: no runtime logic, no I/O operations, no allocation beyond structure",
        "Verify compilation verification loop: generates structure, runs compiler check, repairs on failure, blocks on max repair attempts exceeded",
        "Verify generation mechanism matches spec's 7-step process: parse spec, generate modules, generate types with witnesses, generate signatures with contracts, run compiler, repair until compilable, sanitize via AST inspection",
        "Verify LatticeSubState types match spec section 9.3: generatingStructure/compilingCheck/repairingStructure with correct data interfaces",
        "Verify TypeScript strict mode enforcement per decision lang_005",
        "Verify witness generation integration: type witnesses encoding invariants are generated during Lattice per spec",
        "Verify contract attachment: micro-contracts attached to all todo!() sites per decision contract_001",
        "Verify model assignment: structurer_model used for Lattice generation",
        "Verify context shedding at phase transition to Composition Audit",
        "Example: If LatticeSubState includes 'repairingStructure' with errors array and repairAttempt counter matching spec, mark conformant",
        "Negative case: If the sanitization step (AST inspection for logic leakage) is not implemented, document as warning discrepancy"
      ],
      "startedAt": "2026-02-11T00:41:43.711961+00:00",
      "completedAt": null,
      "updatedAt": "2026-02-11T00:41:43.712145+00:00"
    },
    {
      "id": "US-011",
      "title": "Deep verify Composition Audit implementation vs spec",
      "status": "open",
      "dependsOn": [
        "US-004",
        "US-005"
      ],
      "description": "As a developer, I want a verified report confirming the Composition Audit implementation matches SPECIFICATION.md section 4 (Composition Audit) in contradiction types, output format, phase regression, and handling logic.",
      "acceptanceCriteria": [
        "Produce .agents/audits/verify-composition-audit.md report",
        "Verify all 5 contradiction types implemented: Temporal, Resource, Invariant, Precondition Gap, Postcondition Conflict per spec table",
        "Verify inputs match spec: receives spec constraints, function contracts, type witnesses; does NOT receive implementation bodies or previous reasoning traces",
        "Verify output format matches spec's YAML contradiction report structure: id, severity, involved constraints/contracts, analysis, minimal_scenario, suggested_resolution_options",
        "Verify handling logic: contradictions found \u2192 return to Ignition with report; no contradictions \u2192 proceed to Injection per spec",
        "Verify targeted revision per decision arch_006: return to relevant interview phase, present contradiction, preserve unaffected spec portions",
        "Verify complex contradictions enter BLOCKED state per decision arch_006",
        "Verify CompositionAuditSubState types match spec section 9.3: auditing/reportingContradictions with correct data interfaces (AuditingData with auditorsCompleted array, ReportingContradictionsData with severity)",
        "Verify model assignments: auditor_model for temporal/invariant auditing, auditor_model + architect_model for full audit cross-verification",
        "Verify ledger integration: contradictions recorded in decision ledger per spec",
        "Verify delegated decision downgrade per decision ledger_007: delegated decisions downgrade to 'inferred' when Composition Audit finds contradictions involving the decision",
        "Example: If parseContradictionOutput produces objects matching the spec YAML structure with all required fields, mark conformant",
        "Negative case: If 'Postcondition Conflict' contradiction type is missing from the implementation, document as critical discrepancy"
      ]
    },
    {
      "id": "US-012",
      "title": "Deep verify Injection phase implementation vs spec",
      "status": "open",
      "dependsOn": [
        "US-004",
        "US-005"
      ],
      "description": "As a developer, I want a verified report confirming the Injection phase implementation matches SPECIFICATION.md section 4 (Injection) in Ralph Loop mechanism, context isolation, escalation logic, circuit breaker, and injection order.",
      "acceptanceCriteria": [
        "Produce .agents/audits/verify-injection.md report",
        "Verify Ralph Loop mechanism matches spec's 10-step process: extract context, prompt model, receive implementation, inject via AST, run compiler check, run unit tests, accept/discard atomically, increment failure counter on discard, escalate on threshold, circuit break on all fail",
        "Verify context isolation: each implementation receives ONLY signature, contracts, required types, witness definitions; does NOT receive prior attempts, other functions' implementations, reasoning about failures per spec and decision inject_001",
        "Verify minimal prompt format matches spec section 4 example: FUNCTION, SIGNATURE, CONTRACTS (indented REQUIRES/ENSURES/COMPLEXITY/PURITY), TYPE DEFINITIONS, WITNESS DEFINITIONS, final instruction line",
        "Verify escalation table matches spec section 5.4: correct failure-type to model-tier to action mappings for Syntax, Type, Test, Timeout, Semantic, Security, Coherence failures",
        "Verify circuit breaker hybrid conditions per decision inject_004: breaks if (all tiers exhausted) OR (max attempts exceeded), require_opus_attempt=true",
        "Verify circuit breaker config defaults match spec: max_attempts_per_function=8, module_escalation_rate=0.20, phase_failure_rate=0.10",
        "Verify injection order: topological order based on call graph, leaf functions first, cycles handled as batch per decision inject_006",
        "Verify InjectionSubState types match spec section 9.3: selectingFunction/implementing/verifying/escalating with correct data interfaces",
        "Verify model escalation chain: worker_model \u2192 structurer_model \u2192 architect_model per spec",
        "Verify failure summary format: passes WHAT failed not HOW we tried, includes 'Previous attempts discarded' note per spec",
        "Verify context destruction happens per function, not per phase, per spec's note",
        "Verify security scanner integration runs after Injection per decision security_001",
        "Example: If circuit breaker checks require_opus_attempt before tripping per inject_004, mark conformant",
        "Negative case: If injection order is not topological (e.g., functions injected alphabetically), document as critical discrepancy"
      ]
    },
    {
      "id": "US-013",
      "title": "Deep verify Mesoscopic phase implementation vs spec",
      "status": "open",
      "dependsOn": [
        "US-004",
        "US-005"
      ],
      "description": "As a developer, I want a verified report confirming the Mesoscopic phase implementation matches SPECIFICATION.md section 4 (Mesoscopic) in cluster definition, spec-driven testing, verdict handling, and re-injection scoping.",
      "acceptanceCriteria": [
        "Produce .agents/audits/verify-mesoscopic.md report",
        "Verify key principle: verifier tests spec compliance, NOT implementation correctness; receives spec claims + public interfaces, NOT implementation bodies per spec",
        "Verify cluster definition: modules grouped into testable clusters based on spec relationships, matching spec's YAML structure (name, modules, claims)",
        "Verify spec-driven test generation: generates tests from spec claims per the Test Generation Pipeline in spec section 6",
        "Verify all 6 claim types handled: Invariant, Behavioral, Negative, Temporal, Concurrent, Performance per spec section 6 Claim Classification table",
        "Verify ClusterVerdict type matches spec: pass or fail with violatedClaims array, NO root cause analysis, NO suggested fixes",
        "Verify re-injection scoping per decision test_004: only functions explicitly referenced by violated claims are re-injected (via CLAIM_REF linkage), not entire clusters",
        "Verify violated claims noted in Decision Ledger on failure per spec",
        "Verify MesoscopicSubState types match spec section 9.3: generatingTests/executingCluster/handlingVerdict with correct data interfaces",
        "Verify model assignments: structurer_model for test synthesis, auditor_model for logic auditing",
        "Verify context shedding at phase transition to Mass Defect",
        "Example: If ClusterVerdict type has 'pass' and 'fail' variants with violatedClaims matching spec, mark conformant",
        "Negative case: If re-injection targets entire cluster instead of only CLAIM_REF-linked functions, document as critical discrepancy"
      ]
    },
    {
      "id": "US-014",
      "title": "Deep verify Mass Defect phase implementation vs spec",
      "status": "open",
      "dependsOn": [
        "US-004",
        "US-005"
      ],
      "description": "As a developer, I want a verified report confirming the Mass Defect phase implementation matches SPECIFICATION.md section 4 (Mass Defect) in smell categories, risk levels, pattern catalog, selection algorithm, transformation mechanism, and convergence logic.",
      "acceptanceCriteria": [
        "Produce .agents/audits/verify-mass-defect.md report",
        "Verify all 5 smell categories implemented: Control Flow, Duplication, Idiom Violation, Dead Weight, Clarity Debt per spec table",
        "Verify all 4 risk levels implemented with correct verification requirements: Trivial (compile only), Safe (unit tests), Moderate (integration tests), Structural (full test suite) per spec table",
        "Verify transformation catalog contains all 14 initial patterns from spec table: early-return, guard-clause, extract-helper, loop-to-map, loop-to-comprehension, remove-unused-binding, remove-unreachable, inline-single-use, extract-magic-value, introduce-type-alias, optional-chaining, nullish-coalescing, rename-for-clarity, extract-explanatory-variable",
        "Verify pattern selection algorithm matches spec: collect applicable patterns, skip already-attempted, deduplicate, sort by risk ascending then enables-count descending per spec's selectPatterns implementation",
        "Verify smell definition schema matches spec: id, name, category, description, detection (thresholds, tools, heuristics), applicablePatterns per spec's SmellDefinition interface",
        "Verify pattern definition schema matches spec: id, name, description, risk, riskRationale, verification, guards, enables, prompt per spec's PatternDefinition interface",
        "Verify transformation mechanism matches spec's 6-step process: analyze complexity, detect smells, select patterns, apply (check guards, generate prompt, apply LLM transform, run verification, accept/revert), re-analyze, iterate until convergence",
        "Verify complexity targets match spec: max_cyclomatic_complexity=10, max_function_length_lines=50, max_nesting_depth=4, min_test_coverage=0.80",
        "Verify MassDefectSubState types match spec section 9.3: analyzingComplexity/applyingTransform/verifyingSemantics with correct data interfaces",
        "Verify ESLint integration for static analysis per spec",
        "Example: If transformation catalog TOML contains all 14 patterns with correct risk levels matching spec table, mark conformant",
        "Negative case: If pattern selection sorts by risk descending instead of ascending, document as critical discrepancy"
      ]
    },
    {
      "id": "US-015",
      "title": "Deep verify Orchestrator state machine vs spec section 9",
      "status": "open",
      "dependsOn": [
        "US-004",
        "US-005"
      ],
      "description": "As a developer, I want a verified report confirming the orchestrator implementation (src/protocol/) matches SPECIFICATION.md section 9 in state hierarchy, transition definitions, tick function, persistence, and invariants.",
      "acceptanceCriteria": [
        "Produce .agents/audits/verify-orchestrator.md report",
        "Verify ProtocolState type matches spec section 9.3: blocked/active/completed top-level states with correct data interfaces (BlockedState, ActiveState, CompletedState)",
        "Verify BlockReason type matches spec: canonical_conflict, unresolved_contradiction, circuit_breaker, security_review, user_requested variants",
        "Verify PhaseState type matches spec: all 6 phases with correct sub-state types",
        "Verify all sub-state data interfaces match spec section 9.3 for each phase (InterviewingData, SynthesizingData, etc.)",
        "Verify transition structure matches spec section 9.4: Guard types (always, artifactExists, compileSuccess, testSuccess, noContradictions, allFunctionsComplete, allClustersPass, metricsPass, etc. with composable and/or/not)",
        "Verify Action types match spec section 9.4: none, destroyContext, archiveArtifacts, persistCheckpoint, sendNotification, recordDecision, invokeModel, runCompiler, runTests, sequence",
        "Verify tick function behavior matches spec section 9.5: evaluates guards, executes one transition, handles completed/blocked/active states",
        "Verify PersistedState schema matches spec section 9.6: version, projectId, protocolState, artifacts, ledgerPath, phaseProgress, pending, metrics, createdAt, lastCheckpoint",
        "Verify atomic write pattern: temp file + rename per decision orch_007",
        "Verify orchestrator invariants per spec section 9.7: determinism, context isolation, atomic persistence, resumability, no reasoning, compile oracle",
        "Verify orchestrator does classification not reasoning per decision orch_003",
        "Example: If BlockReason includes all 5 variants from spec including 'user_requested', mark conformant",
        "Negative case: If Guard type is missing 'circuitBreakerTripped' variant, document as warning discrepancy"
      ]
    },
    {
      "id": "US-016",
      "title": "Verify CLI (Phase 4.1) completeness and Phase 4.2/4.3 status",
      "status": "open",
      "dependsOn": [
        "US-001",
        "US-004"
      ],
      "description": "As a developer, I want a verified report confirming Phase 4.1 CLI is fully implemented, Phase 4.2 attempted items are accurately reflected, and Phase 4.3 status is correct.",
      "acceptanceCriteria": [
        "Produce .agents/audits/verify-phase4-cli.md report",
        "Verify status command (src/cli/commands/status.ts): displays current protocol state, shows hierarchical sub-state (phase > task > operation), includes inline telemetry per prd-cli-interface.json US-024/US-025",
        "Verify resolve command (src/cli/commands/resolve.ts): implements interactive arrow-key selection per decision cli_001 and SPECIFICATION.md section 9.6 Interactive Resolve Mode, supports numbered input alternative",
        "Verify resume command (src/cli/commands/resume.ts): executes orchestrator tick loop until blocked/completed per prd-cli-interface.json US-022, uses ExternalOperations implementation, handles graceful shutdown on Ctrl+C per US-030",
        "Verify version command exists and returns correct version",
        "Verify spinner component (src/cli/components/): displays current phase and substate during execution per US-021",
        "Verify ExternalOperations implementation (src/cli/operations.ts): implements model calling, compilation, test execution, archiving per US-023",
        "Verify telemetry collector (src/cli/telemetry.ts): tracks model calls, tokens, execution time per US-024",
        "Verify error suggestions (src/cli/errors.ts): maps error types to contextual suggestions per US-028",
        "Verify execution summary on completion/block per US-029",
        "For Phase 4.2: verify webhook integration (src/notifications/webhook.ts) exists and is tested, verify reminder scheduling (src/notifications/reminder.ts) exists and is tested, note which 4.2 items are completed vs deferred",
        "For Phase 4.3: verify web dashboard is not implemented (correct status: deferred/optional), confirm ROADMAP accurately reflects this",
        "Example: If resolve command implements arrow-key navigation per cli_001, mark Phase 4.1 'option selection' as conformant",
        "Negative case: If resume command doesn't actually call orchestrator.tick() in a loop, document as critical discrepancy"
      ]
    },
    {
      "id": "US-017",
      "title": "Deep verify cross-cutting concerns vs spec section 5",
      "status": "open",
      "dependsOn": [
        "US-004",
        "US-005"
      ],
      "description": "As a developer, I want a verified report confirming that all cross-cutting concerns (Decision Ledger operations, Type Witnesses, Micro-Contracts, Escalation Logic) match SPECIFICATION.md section 5.",
      "acceptanceCriteria": [
        "Produce .agents/audits/verify-cross-cutting.md report",
        "Verify Decision Ledger operations match spec section 5.1: append, supersede (not 'override'), invalidate, cascade, reinstate operations all implemented",
        "Verify hybrid append-only model per decision ledger_004: entries never modified, status field marks active/superseded/invalidated",
        "Verify rationale field never included in LLM prompts per decision ledger_005: only constraint text fed to phases",
        "Verify ledger injection format matches spec section 5.1: CANONICAL, INFERRED, SUSPENDED groupings with decision IDs",
        "Verify Type Witness system matches spec section 5.2: universal witness schema, verification levels (proof, distinction, runtime, doc per decision witness_003), TypeScript branded type generation",
        "Verify witness schema uses flat base_type string per decision witness_005",
        "Verify Micro-Contract grammar matches spec section 5.3: REQUIRES, ENSURES, INVARIANT, COMPLEXITY, PURITY, CLAIM_REF clauses all parseable",
        "Verify CLAIM_REF linkage per decision contract_003: micro-contracts include CLAIM_REF comments linking to spec claim IDs",
        "Verify Escalation Logic matches spec section 5.4: failure taxonomy (syntax, type, test, timeout, semantic, complexity, security, coherence), escalation table matches all rows",
        "Verify performance claim verification per decision test_005: empirical scaling tests at multiple input sizes, >20% variance triggers failure",
        "Verify signature complexity formula per decision routing_005: genericParams*2 + unionMembers + lifetimeParams*2 + nestedTypeDepth + paramCount*0.5",
        "Example: If ledger's supersede operation creates new entry and marks old as 'superseded' per ledger_004, mark conformant",
        "Negative case: If escalation table is missing 'Security | Any | 1 | Escalate to architect_model immediately' row, document as critical discrepancy"
      ]
    },
    {
      "id": "US-018",
      "title": "Final cross-document consistency sweep and discrepancy index",
      "status": "open",
      "dependsOn": [
        "US-006",
        "US-007",
        "US-008",
        "US-009",
        "US-010",
        "US-011",
        "US-012",
        "US-013",
        "US-014",
        "US-015",
        "US-016",
        "US-017"
      ],
      "description": "As a developer, I want a final consistency sweep across all documents and a master discrepancy index so that I have a single reference for all findings from the audit.",
      "acceptanceCriteria": [
        "Produce .agents/audits/discrepancy-index.md as master index",
        "Read all individual audit reports (.agents/audits/verify-*.md) and aggregate findings",
        "Verify cross-references between SPECIFICATION.md, ROADMAP.md, DECISIONS.toml, and README.md are all consistent after US-001 through US-006 changes",
        "Check for any remaining specific model name references in SPECIFICATION.md (should be zero after US-004)",
        "Check for any remaining phase number prefixes in SPECIFICATION.md (should be zero after US-003)",
        "Verify DECISIONS.toml decisions are not contradicted by each other (check for conflicting constraints)",
        "Verify ROADMAP.md milestones match SPECIFICATION.md feature descriptions (e.g., if ROADMAP says 'Implement circuit breaker', spec should describe circuit breaker)",
        "Produce summary statistics: total discrepancies found, by severity (critical/warning/info), by category, by phase",
        "Produce per-area conformance verdicts: list each area with conformant/partially conformant/non-conformant status",
        "List all critical discrepancies with cross-references to their detailed reports",
        "List recommendations: prioritized list of actions to address discrepancies (most critical first)",
        "Example: Index entry: '| Injection | warning | Circuit breaker config default mismatch | verify-injection.md#CB-001 | Update config default |'",
        "Negative case: If no discrepancies found in an area, still list it in the index as 'conformant' with no action required"
      ]
    }
  ]
}
